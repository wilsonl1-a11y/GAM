<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <title>3D Battle Royale - 2025 Edition</title>

    <style>

        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; background: #000; }

        #hud { position: absolute; bottom: 30px; left: 30px; color: white; text-shadow: 2px 2px 4px #000; pointer-events: none; }

        #crosshair { position: absolute; top: 50%; left: 50%; width: 20px; height: 20px; border: 2px solid white; border-radius: 50%; transform: translate(-50%, -50%); pointer-events: none; }

        #crosshair::after { content: ''; position: absolute; top: 50%; left: 50%; width: 4px; height: 4px; background: white; transform: translate(-50%, -50%); }

        #storm-timer { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); color: #ff00ff; font-size: 24px; font-weight: bold; text-align: center; }

        .rarity-Common { color: #d3d3d3; } .rarity-Rare { color: #0070dd; } .rarity-Epic { color: #a335ee; } .rarity-Legendary { color: #ff00ff; }

        #msg { position: absolute; top: 40%; width: 100%; text-align: center; color: white; font-size: 30px; background: rgba(0,0,0,0.5); padding: 20px 0; z-index: 10; }

    </style>

</head>

<body>

    <div id="msg">CLICK TO START BATTLE ROYALE<br><small style="font-size:18px">WASD to Move | Click to Shoot | 'E' to Switch Gun</small></div>

    <div id="storm-timer">STORM RADIUS: <span id="radius-val">1000</span>m</div>

    <div id="crosshair"></div>

    <div id="hud">

        <div style="font-size: 24px;">Weapon: <span id="gun-name">Pickaxe</span></div>

        <div id="gun-rarity" style="font-size: 18px; font-weight: bold;">Common</div>

        <div style="margin-top:10px; width: 250px; height: 20px; background: #333; border: 2px solid white;">

            <div id="hp-bar" style="width: 100%; height: 100%; background: #2ecc71; transition: width 0.1s;"></div>

        </div>

        <div id="hp-text">100 HP</div>

    </div>


    <script src="cdnjs.cloudflare.com"></script>

    <script>

        let scene, camera, renderer, raycaster, storm, prevTime = performance.now();

        let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false, canJump = false;

        let velocity = new THREE.Vector3(), direction = new THREE.Vector3();

        let enemies = [], stormRadius = 1000, playerHP = 100;

       

        const rarities = [

            { name: 'Common', color: '#d3d3d3', mult: 1 },

            { name: 'Rare', color: '#0070dd', mult: 1.5 },

            { name: 'Epic', color: '#a335ee', mult: 2 },

            { name: 'Legendary', color: '#ff00ff', mult: 3 }

        ];


        const weapons = [

            { name: 'SMG', range: 150, damage: 10 },

            { name: 'AR', range: 400, damage: 25 },

            { name: 'Shotgun', range: 60, damage: 50 },

            { name: 'Sniper', range: 1000, damage: 100 }

        ];


        let currentGun = weapons[0];

        let currentRarity = rarities[0];


        init();

        animate();


        function init() {

            scene = new THREE.Scene();

            scene.background = new THREE.Color(0x87ceeb);

            scene.fog = new THREE.FogExp2(0x87ceeb, 0.001);


            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 5000);

            camera.position.y = 10;


            const light = new THREE.HemisphereLight(0xeeeeff, 0x777788, 0.75);

            scene.add(light);


            // Large Map

            const groundGeo = new THREE.PlaneGeometry(3000, 3000);

            const groundMat = new THREE.MeshLambertMaterial({ color: 0x27ae60 });

            const ground = new THREE.Mesh(groundGeo, groundMat);

            ground.rotation.x = -Math.PI / 2;

            scene.add(ground);


            // Purple Storm Visual

            const stormGeo = new THREE.CylinderGeometry(1, 1, 1000, 64, 1, true);

            const stormMat = new THREE.MeshBasicMaterial({ color: 0x9b59b6, side: THREE.DoubleSide, transparent: true, opacity: 0.3 });

            storm = new THREE.Mesh(stormGeo, stormMat);

            scene.add(storm);


            // Enemies

            for (let i = 0; i < 20; i++) { spawnEnemy(); }


            renderer = new THREE.WebGLRenderer({ antialias: true });

            renderer.setSize(window.innerWidth, window.innerHeight);

            document.body.appendChild(renderer.domElement);


            raycaster = new THREE.Raycaster();


            // Controls

            document.addEventListener('click', () => {

                document.body.requestPointerLock();

                document.getElementById('msg').style.display = 'none';

            });


            document.addEventListener('mousemove', (e) => {

                if (document.pointerLockElement) {

                    camera.rotation.y -= e.movementX * 0.002;

                    camera.rotation.x -= e.movementY * 0.002;

                    camera.rotation.x = Math.max(-Math.PI/2, Math.min(Math.PI/2, camera.rotation.x));

                }

            });


            document.addEventListener('keydown', (e) => {

                if(e.code === 'KeyW') moveForward = true;

                if(e.code === 'KeyS') moveBackward = true;

                if(e.code === 'KeyA') moveLeft = true;

                if(e.code === 'KeyD') moveRight = true;

                if(e.code === 'Space' && canJump) { velocity.y += 150; canJump = false; }

                if(e.code === 'KeyE') switchWeapon();

            });


            document.addEventListener('keyup', (e) => {

                if(e.code === 'KeyW') moveForward = false;

                if(e.code === 'KeyS') moveBackward = false;

                if(e.code === 'KeyA') moveLeft = false;

                if(e.code === 'KeyD') moveRight = false;

            });


            document.addEventListener('mousedown', shoot);

            window.addEventListener('resize', onWindowResize);

            switchWeapon();

        }


        function spawnEnemy() {

            const geometry = new THREE.BoxGeometry(10, 20, 10);

            const material = new THREE.MeshLambertMaterial({ color: 0xe74c3c });

            const enemy = new THREE.Mesh(geometry, material);

            const angle = Math.random() * Math.PI * 2;

            const dist = 200 + Math.random() * 600;

            enemy.position.set(Math.cos(angle)*dist, 10, Math.sin(angle)*dist);

            enemy.userData = { health: 100 };

            scene.add(enemy);

            enemies.push(enemy);

        }


        function switchWeapon() {

            currentGun = weapons[Math.floor(Math.random()*weapons.length)];

            currentRarity = rarities[Math.floor(Math.random()*rarities.length)];

            const nameEl = document.getElementById('gun-name');

            const rareEl = document.getElementById('gun-rarity');

            nameEl.innerText = currentGun.name;

            rareEl.innerText = currentRarity.name;

            rareEl.style.color = currentRarity.color;

        }


        function shoot() {

            if (!document.pointerLockElement) return;

            raycaster.setFromCamera(new THREE.Vector2(0,0), camera);

            raycaster.far = currentGun.range;

            const intersects = raycaster.intersectObjects(enemies);


            if (intersects.length > 0) {

                let target = intersects[0].object;

                target.userData.health -= (currentGun.damage * currentRarity.mult);

                target.material.color.setHex(0xffffff);

                setTimeout(() => target.material.color.setHex(0xe74c3c), 100);


                if (target.userData.health <= 0) {

                    scene.remove(target);

                    enemies = enemies.filter(e => e !== target);

                    spawnEnemy();

                }

            }

        }


        function onWindowResize() {

            camera.aspect = window.innerWidth / window.innerHeight;

            camera.updateProjectionMatrix();

            renderer.setSize(window.innerWidth, window.innerHeight);

        }


        function animate() {

            requestAnimationFrame(animate);

            const time = performance.now();

            const delta = (time - prevTime) / 1000;


            if (document.pointerLockElement) {

                // Storm Logic

                stormRadius -= 0.1;

                if(stormRadius < 10) stormRadius = 10;

                storm.scale.set(stormRadius, 1, stormRadius);

                document.getElementById('radius-val').innerText = Math.floor(stormRadius);


                const playerDist = Math.sqrt(camera.position.x**2 + camera.position.z**2);

                if (playerDist > stormRadius) {

                    playerHP -= 0.15;

                }


                // Movement Logic

                velocity.x -= velocity.x * 10.0 * delta;

                velocity.z -= velocity.z * 10.0 * delta;

                velocity.y -= 9.8 * 40.0 * delta;


                direction.z = Number(moveForward) - Number(moveBackward);

                direction.x = Number(moveRight) - Number(moveLeft);

                direction.normalize();


                if (moveForward || moveBackward) velocity.z -= direction.z * 800.0 * delta;

                if (moveLeft || moveRight) velocity.x -= direction.x * 800.0 * delta;


                camera.translateX(-velocity.x * delta);

                camera.translateZ(velocity.z * delta);

                camera.position.y += (velocity.y * delta);


                if (camera.position.y < 10) {

                    velocity.y = 0;

                    camera.position.y = 10;

                    canJump = true;

                }


                // Enemy AI with MISS MECHANIC

                enemies.forEach(en => {

                    en.lookAt(camera.position);

                    en.translateZ(0.6); // Move toward player


                    const dist = en.position.distanceTo(camera.position);

                    if(dist < 100) {

                        // AI attempts to fire

                        if(Math.random() < 0.015) {

                            // Hit chance: AI only has 20% accuracy

                            if(Math.random() < 0.20) {

                                playerHP -= 8;

                                // Visual flash for taking damage

                                renderer.setClearColor(0xff0000, 0.2);

                                setTimeout(() => renderer.setClearColor(0x87ceeb, 1), 50);

                            }

                        }

                    }

                });


                // HUD Update

                document.getElementById('hp-bar').style.width = Math.max(0, playerHP) + "%";

                document.getElementById('hp-text').innerText = Math.ceil(playerHP) + " HP";


                if(playerHP <= 0) {

                    alert("You got touched ehheheh! Refresh to drop again.");

                    location.reload();

                }

            }

            prevTime = time;

            renderer.render(scene, camera);

        }

    </script>

</body>

</html>


